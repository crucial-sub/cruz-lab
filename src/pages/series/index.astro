---
export const prerender = false;

import BaseLayout from '@/layouts/BaseLayout.astro';
import FadeInSection from '@/components/islands/FadeInSection';
import TextReveal from '@/components/islands/TextReveal';
import SeriesCard from '@/components/islands/SeriesCard';
import { getPublishedSeries, getSeriesReadingTime } from '@/lib/series';

const title = 'Series';
const description = '시리즈로 정리된 심도있는 학습 기록';

// 시리즈 목록 가져오기
const seriesList = await getPublishedSeries();

// 각 시리즈의 총 읽기 시간 계산
const seriesWithReadingTime = await Promise.all(
  seriesList.map(async (series) => ({
    ...series,
    totalReadingTime: await getSeriesReadingTime(series.id),
  }))
);
---

<BaseLayout title={title} description={description}>
  <div class="py-8">
    <!-- 페이지 헤더 -->
    <FadeInSection client:visible>
      <div class="mb-12 text-center">
        <h1 class="mb-4 text-4xl font-extrabold md:text-5xl">
          <TextReveal client:visible text="Series" type="chars" staggerChildren={0.08} />
        </h1>
        <p class="mx-auto max-w-2xl text-lg text-text-secondary">
          연관된 포스트들을 시리즈로 묶어 체계적으로 학습하세요.
        </p>
      </div>
    </FadeInSection>

    <!-- 시리즈가 없을 때 -->
    {
      seriesWithReadingTime.length === 0 && (
        <FadeInSection client:visible delay={0.2}>
          <div class="flex flex-col items-center justify-center py-20 text-center">
            <div class="mb-6 rounded-full bg-bg-card p-8">
              <svg
                class="h-16 w-16 text-text-secondary"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width={1.5}
                  d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
                />
              </svg>
            </div>
            <h3 class="mb-2 text-xl font-semibold text-text-primary">
              아직 작성된 시리즈가 없습니다
            </h3>
            <p class="mb-6 max-w-md text-text-secondary">
              곧 새로운 시리즈가 올라올 예정입니다.
            </p>
            <a
              href="/blog"
              class="inline-flex items-center gap-2 rounded-xl bg-brand px-6 py-3 font-medium text-white transition-all hover:brightness-110"
            >
              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width={2}
                  d="M15 19l-7-7 7-7"
                />
              </svg>
              블로그 글 보기
            </a>
          </div>
        </FadeInSection>
      )
    }

    <!-- 시리즈 그리드 -->
    {
      seriesWithReadingTime.length > 0 && (
        <FadeInSection client:visible delay={0.2}>
          <div class="mb-6 text-sm text-text-secondary">
            총 {seriesWithReadingTime.length}개의 시리즈
          </div>
          <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            {seriesWithReadingTime.map((series, index) => (
              <SeriesCard
                client:visible
                id={series.id}
                name={series.name}
                slug={series.slug}
                description={series.description}
                coverImage={series.coverImage}
                postCount={series.postCount}
                totalReadingTime={series.totalReadingTime}
                updatedAt={series.updatedAt}
                index={index}
              />
            ))}
          </div>
        </FadeInSection>
      )
    }
  </div>
</BaseLayout>
